# FoxRiver Database Entity Relationship Diagram (ERD)

This diagram visualizes the structure and relationships of the FoxRiver database, illustrating how users, financial transactions, memberships, and content interact.

```mermaid
erDiagram
    USER ||--o{ TASK_COMPLETION : "performs"
    USER ||--o{ COMMISSION : "earns"
    USER ||--o{ SALARY : "receives"
    USER ||--o{ DEPOSIT : "requests"
    USER ||--o{ DEPOSIT : "approves"
    USER ||--o{ WITHDRAWAL : "requests"
    USER ||--o{ WITHDRAWAL : "approves"
    USER ||--o{ WEALTH_INVESTMENT : "invests"
    USER ||--o{ SPIN_RESULT : "plays"
    USER ||--o{ DAILY_VIDEO_ASSIGNMENT : "assigned"
    USER ||--o{ RANK_UPGRADE_REQUEST : "requests"
    USER ||--o{ RANK_UPGRADE_REQUEST : "approves"
    USER ||--o| CHAT : "owns"
    USER ||--o{ CHAT_MESSAGE : "sends"
    USER ||--o{ USER : "refers"
    USER ||--o{ NEWS : "creates"
    
    MEMBERSHIP ||--o{ USER : "defines_rank"
    
    TASK ||--o{ TASK_COMPLETION : "completed_by"
    TASK_COMPLETION ||--o{ COMMISSION : "triggers"
    
    COURSE_CATEGORY ||--o{ COURSE : "categorizes"
    
    PLAYLIST ||--o{ VIDEO_POOL : "contains"
    
    BANK_ACCOUNT ||--o{ DEPOSIT : "payment_method"
    
    DEPOSIT ||--o| RANK_UPGRADE_REQUEST : "links_to"
    
    WEALTH_FUND ||--o{ WEALTH_INVESTMENT : "invested_in"
    
    SLOT_TIER ||--o{ SPIN_RESULT : "used_in"
    
    CHAT ||--o{ CHAT_MESSAGE : "contains"

    USER {
        int id PK
        string name
        string phone
        string password
        enum role
        enum membershipLevel
        decimal incomeWallet
        decimal personalWallet
        decimal tasksWallet
        string transactionPassword
        json bankAccount
        int referrerId FK
        string invitationCode
        boolean isActive
    }

    MEMBERSHIP {
        int id PK
        enum level
        decimal price
        boolean canWithdraw
        int order
        boolean hidden
    }

    DEPOSIT {
        int id PK
        int user FK
        decimal amount
        int paymentMethod FK
        string transactionFT
        string orderId
        enum status
        int approvedBy FK
    }

    WITHDRAWAL {
        int id PK
        int user FK
        decimal amount
        enum walletType
        decimal netAmount
        enum status
        int approvedBy FK
    }

    COMMISSION {
        int id PK
        int user FK "Earner"
        int downlineUser FK "Source"
        decimal amountEarned
        int sourceTask FK
        string sourceMembership
    }

    RANK_UPGRADE_REQUEST {
        int id PK
        int user FK
        enum currentLevel
        enum requestedLevel
        int depositId FK
        enum status
        int approvedBy FK
    }

    WEALTH_INVESTMENT {
        int id PK
        int user FK
        int wealthFund FK
        decimal amount
        enum status
        date endDate
    }

    SPIN_RESULT {
        int id PK
        int user FK
        decimal amountWon
        int tier FK
    }

    TASK_COMPLETION {
        int id PK
        int user FK
        int task FK
        decimal earningsAmount
    }
```

## Core Components

### 1. User & Membership
The central part of the system. Users are categorized by **Membership Levels** (Intern to Rank 10), which determine their earning potential and withdrawal rights. The `referrerId` creates a tree-like network for the commission system.

### 2. Financial Ecosystem
- **Wallets**: Users have three separate wallets (`Income`, `Personal`, `Tasks`).
- **Transactions**: `Deposits` and `Withdrawals` are the primary flows.
- **Incentives**: `Commissions` are generated by downline activity, and `Salaries` are paid based on recruitment thresholds.

### 3. Rank Upgrades
Upgrades can happen via direct deposit (linking a `Deposit` to a `RankUpgradeRequest`) or via Personal Wallet (creating a self-approved `RankUpgradeRequest` for history).

### 4. Earning Activities
- **Tasks**: Daily video watching recorded in `TaskCompletion`.
- **Wealth**: Fixed-term investments in `WealthFund`.
- **Games**: Slot machine interaction recorded in `SpinResult`.

### 5. Support & Content
- **Chat**: 1-on-1 support system.
- **Courses**: Educational content organized by category.
- **News**: System-wide announcements.
